<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="SeriesTracker.Views.NewSeriesPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:Models="clr-namespace:SeriesTracker.Models"
    xmlns:controls="clr-namespace:SeriesTracker.Controls.MaterialEntry"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:vModels="clr-namespace:SeriesTracker.ViewModels"
    Title="Данные сериала"
    BackgroundColor="{AppThemeBinding Light=#ffffff,
                                      Dark=#121212}"
    Shell.BackgroundColor="{AppThemeBinding Light={StaticResource Primary},
                                            Dark=#121212}"
    Shell.FlyoutBehavior="Disabled"
    Shell.NavBarIsVisible="True"
    Shell.TabBarIsVisible="False">

    <ContentPage.Resources>
        <Style x:Key="InvalidEntryStyle" TargetType="Entry">
            <Setter Property="TextColor" Value="Red" />
        </Style>
    </ContentPage.Resources>


    <ScrollView>
        <StackLayout Margin="20">
            <StackLayout VerticalOptions="FillAndExpand">


                <Grid x:Name="gridContainer">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="220" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="170" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <Border
                        Grid.Row="0"
                        Grid.Column="1"
                        Margin="15,15,15,0"
                        HeightRequest="220"
                        HorizontalOptions="Fill"
                        VerticalOptions="Fill"
                        WidthRequest="170">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="10" />
                        </Border.StrokeShape>
                        <Image Aspect="Fill" Source="poster.png" />
                    </Border>

                    <StackLayout Grid.Row="0" Grid.Column="2">
                        <Border
                            Margin="10,20,0,0"
                            Padding="5"
                            HorizontalOptions="Center"
                            Stroke="lime"
                            StrokeShape="RoundRectangle 50"
                            StrokeThickness="1"
                            VerticalOptions="Start">
                            <ImageButton
                                HeightRequest="30"
                                Source="myanimelist.png"
                                WidthRequest="30">
                                <ImageButton.Behaviors>
                                    <toolkit:IconTintColorBehavior TintColor="LimeGreen" />
                                </ImageButton.Behaviors>
                            </ImageButton>
                        </Border>

                        <Border
                            Margin="10,20,0,0"
                            Padding="5"
                            HorizontalOptions="Center"
                            Stroke="lime"
                            StrokeShape="RoundRectangle 50"
                            StrokeThickness="1"
                            VerticalOptions="Start">
                            <ImageButton
                                HeightRequest="30"
                                Source="shikimori.png"
                                WidthRequest="30">
                                <ImageButton.Behaviors>
                                    <toolkit:IconTintColorBehavior TintColor="LimeGreen" />
                                </ImageButton.Behaviors>
                            </ImageButton>
                        </Border>
                    </StackLayout>
                    <Editor
                        x:Name="nameEditor"
                        Grid.Row="1"
                        Grid.Column="0"
                        Grid.ColumnSpan="3"
                        AutoSize="TextChanges"
                        FontSize="Title"
                        HorizontalOptions="FillAndExpand"
                        HorizontalTextAlignment="Center"
                        Placeholder="Название тайтла"
                        Text="{Binding Series.seriesName, Mode=TwoWay}"
                        VerticalTextAlignment="Center">
                        <Editor.Keyboard>
                            <Keyboard x:FactoryMethod="Create">
                                <x:Arguments>
                                    <KeyboardFlags>Suggestions,CapitalizeSentence</KeyboardFlags>
                                </x:Arguments>
                            </Keyboard>
                        </Editor.Keyboard>
                        <Editor.Behaviors>
                            <toolkit:TextValidationBehavior
                                x:Name="nameValidator"
                                Flags="ValidateOnValueChanged,ValidateOnAttaching"
                                InvalidStyle="{StaticResource InvalidEntryStyle}"
                                MinimumLength="1" />
                        </Editor.Behaviors>
                    </Editor>

                    <toolkit:Expander
                        x:Name="descriptionExpander"
                        Grid.Row="3"
                        Grid.ColumnSpan="3"
                        Padding="10,0,10,10"
                        ExpandedChanged="descriptionExpander_ExpandedChanged"
                        VerticalOptions="CenterAndExpand">
                        <toolkit:Expander.Header>
                            <HorizontalStackLayout HorizontalOptions="CenterAndExpand">
                                <Label
                                    x:Name="descriptionCaption"
                                    FontAttributes="Italic"
                                    FontFamily="NunitoItalic"
                                    FontSize="14"
                                    Text="Открыть описание" />
                                <Image
                                    x:Name="descriptionImage"
                                    HeightRequest="20"
                                    Source="downarrow.png"
                                    WidthRequest="20">
                                    <Image.Behaviors>
                                        <toolkit:IconTintColorBehavior TintColor="Red" />
                                    </Image.Behaviors>
                                </Image>
                            </HorizontalStackLayout>
                        </toolkit:Expander.Header>
                        <Editor
                            Grid.Row="2"
                            Grid.Column="0"
                            Grid.ColumnSpan="3"
                            AutoSize="TextChanges"
                            FontSize="13"
                            HorizontalOptions="FillAndExpand"
                            MinimumHeightRequest="250"
                            Placeholder="Описание тайтла..."
                            VerticalTextAlignment="Start">
                            <Editor.Keyboard>
                                <Keyboard x:FactoryMethod="Create">
                                    <x:Arguments>
                                        <KeyboardFlags>Suggestions,CapitalizeSentence</KeyboardFlags>
                                    </x:Arguments>
                                </Keyboard>
                            </Editor.Keyboard>
                            <Editor.Behaviors>
                                <toolkit:TextValidationBehavior
                                    Flags="ValidateOnValueChanged,ValidateOnAttaching"
                                    InvalidStyle="{StaticResource InvalidEntryStyle}"
                                    MinimumLength="1" />
                            </Editor.Behaviors>
                        </Editor>
                    </toolkit:Expander>
                </Grid>

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>


                    <controls:MaterialEntry
                        x:Name="aaa"
                        Grid.Row="0"
                        Grid.Column="0"
                        HorizontalOptions="Center"
                        Label="Начальная серия"
                        Text="{Binding Series.startEpisode, Mode=TwoWay}" />

                    <controls:MaterialEntry
                        Grid.Row="0"
                        Grid.Column="2"
                        HorizontalOptions="Center"
                        Label="Последняя серия"
                        Text="{Binding Series.lastEpisode, Mode=TwoWay}" />
                </Grid>


                <StackLayout Orientation="Horizontal">
                    <StackLayout
                        Margin="5"
                        Padding="5"
                        Orientation="Horizontal">
                        <Label
                            BindingContext="{x:Reference startEntry}"
                            Text="Начальная серия:"
                            TextColor="{Binding TextColor}" />
                        <Entry
                            x:Name="startEntry"
                            Margin="0,-12,0,0"
                            HorizontalTextAlignment="Center"
                            Keyboard="Numeric"
                            MaxLength="4"
                            Text="{Binding Series.startEpisode, Mode=TwoWay}"
                            TextChanged="startEntry_TextChanged"
                            Unfocused="startEntry_Unfocused">
                            <Entry.Behaviors>
                                <toolkit:CharactersValidationBehavior
                                    CharacterType="Digit"
                                    Flags="ValidateOnValueChanged"
                                    InvalidStyle="{StaticResource InvalidEntryStyle}"
                                    RegexPattern="^0{1}$|^[1-9][0-9]*$" />
                            </Entry.Behaviors>
                        </Entry>
                    </StackLayout>
                    <StackLayout
                        Margin="5"
                        Padding="5"
                        Orientation="Horizontal">
                        <Label
                            BindingContext="{x:Reference lastEntry}"
                            Text="Последняя серия:"
                            TextColor="{Binding TextColor}" />
                        <Entry
                            x:Name="lastEntry"
                            Margin="0,-12,0,0"
                            HorizontalTextAlignment="Center"
                            Keyboard="Numeric"
                            MaxLength="4"
                            Text="{Binding Series.lastEpisode, Mode=TwoWay}"
                            TextChanged="lastEntry_TextChanged"
                            Unfocused="lastEntry_Unfocused">
                            <Entry.Behaviors>
                                <toolkit:CharactersValidationBehavior
                                    CharacterType="Digit"
                                    Flags="ValidateOnValueChanged"
                                    InvalidStyle="{StaticResource InvalidEntryStyle}"
                                    RegexPattern="^0{1}$|^[1-9][0-9]*$" />
                            </Entry.Behaviors>
                        </Entry>
                    </StackLayout>
                </StackLayout>
                <StackLayout
                    Margin="5"
                    Padding="5"
                    HorizontalOptions="Center"
                    Orientation="Horizontal">
                    <Label
                        BindingContext="{x:Reference currentEntry}"
                        Text="Текущая серия:"
                        TextColor="{Binding TextColor}" />
                    <Entry
                        x:Name="currentEntry"
                        Margin="0,-12,0,0"
                        HorizontalTextAlignment="Center"
                        Keyboard="Numeric"
                        MaxLength="4"
                        Text="{Binding Series.currentEpisode, Mode=TwoWay}"
                        TextChanged="currentEntry_TextChanged"
                        Unfocused="currentEntry_Unfocused">
                        <Entry.Behaviors>
                            <toolkit:CharactersValidationBehavior
                                CharacterType="Digit"
                                Flags="ValidateOnValueChanged"
                                InvalidStyle="{StaticResource InvalidEntryStyle}"
                                RegexPattern="^0{1}$|^[1-9][0-9]*$" />
                        </Entry.Behaviors>
                    </Entry>
                </StackLayout>
                <StackLayout
                    Margin="5"
                    Padding="5"
                    Orientation="Horizontal">
                    <StackLayout
                        Margin="5"
                        Padding="5"
                        Orientation="Horizontal">
                        <Label Text="Наличие сезонов:" />
                        <CheckBox
                            x:Name="seasonCheckBox"
                            Margin="0,-12,0,0"
                            CheckedChanged="CheckBox_CheckedChanged" />
                    </StackLayout>
                    <StackLayout
                        Margin="5"
                        Padding="5"
                        Orientation="Horizontal">
                        <Label
                            x:Name="seasonLabel"
                            BindingContext="{x:Reference seasonEntry}"
                            IsEnabled="False"
                            Text="Сезон:"
                            TextColor="{Binding TextColor}" />
                        <Entry
                            x:Name="seasonEntry"
                            Margin="0,-12,0,0"
                            HorizontalTextAlignment="Center"
                            IsEnabled="False"
                            Keyboard="Numeric"
                            MaxLength="4"
                            Text="{Binding Series.seriesSeason, Mode=TwoWay}"
                            TextChanged="seasonEntry_TextChanged">
                            <Entry.Behaviors>
                                <toolkit:CharactersValidationBehavior
                                    CharacterType="Digit"
                                    Flags="ValidateOnValueChanged"
                                    InvalidStyle="{StaticResource InvalidEntryStyle}"
                                    RegexPattern="^0{1}$|^[1-9][0-9]*$" />
                            </Entry.Behaviors>
                        </Entry>
                    </StackLayout>
                </StackLayout>
                <StackLayout
                    Margin="5"
                    Padding="5"
                    HorizontalOptions="Center"
                    Orientation="Horizontal">
                    <Label
                        BindingContext="{x:Reference releaseEntry}"
                        Text="Год Выхода:"
                        TextColor="{Binding TextColor}" />
                    <Entry
                        x:Name="releaseEntry"
                        Margin="0,-12,0,0"
                        HorizontalTextAlignment="Center"
                        Keyboard="Numeric"
                        MaxLength="4"
                        Text="{Binding Series.releaseYear, Mode=TwoWay}"
                        TextChanged="releaseEntry_TextChanged"
                        Unfocused="releaseEntry_Unfocused">
                        <Entry.Behaviors>
                            <toolkit:CharactersValidationBehavior
                                CharacterType="Digit"
                                Flags="ValidateOnValueChanged"
                                InvalidStyle="{StaticResource InvalidEntryStyle}"
                                MinimumLength="4"
                                RegexPattern="^[1-9][0-9]*$" />
                        </Entry.Behaviors>
                    </Entry>
                </StackLayout>
            </StackLayout>


            <StackLayout Orientation="Horizontal" VerticalOptions="End">
                <Border
                    Margin="0,10,0,0"
                    BackgroundColor="{AppThemeBinding Light=Black,
                                                      Dark=White}"
                    HeightRequest="75"
                    HorizontalOptions="FillAndExpand"
                    Stroke="{AppThemeBinding Light=Black,
                                             Dark=White}"
                    VerticalOptions="End">
                    <Button
                        x:Name="saveBtn"
                        BackgroundColor="{AppThemeBinding Light=Black,
                                                          Dark=White}"
                        Command="{Binding SaveSeriesCommand}"
                        FontSize="20"
                        Text="Сохранить"
                        TextColor="{AppThemeBinding Light=White,
                                                    Dark=Black}" />
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="5" />
                    </Border.StrokeShape>
                    <Border.Shadow
                        Brush="{AppThemeBinding Light=Black,
                                                Dark=White}"
                        Opacity="0.7"
                        Radius="20"
                        Offset="20,20" />
                </Border>
            </StackLayout>
        </StackLayout>
    </ScrollView>
</ContentPage>